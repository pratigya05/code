#include <iostream>
using namespace std;

int main() {
    int matrix[20][20];
    int rows, cols;

    cout << "Enter number of rows: ";
    cin >> rows;
    cout << "Enter number of columns: ";
    cin >> cols;

    cout << "Enter matrix elements:\n";
    for (int i = 0; i < rows; i++) {
        for (int j = 0; j < cols; j++) {
            cin >> matrix[i][j];
        }
    }

    // Count non-zero elements
    int nz = 0;
    for (int i = 0; i < rows; i++) {
        for (int j = 0; j < cols; j++) {
            if (matrix[i][j] != 0)
                nz++;
        }
    }

    // Triplet sparse representation
    int sp[100][3];
    sp[0][0] = rows;
    sp[0][1] = cols;
    sp[0][2] = nz;

    int k = 1;
    for (int i = 0; i < rows; i++) {
        for (int j = 0; j < cols; j++) {
            if (matrix[i][j] != 0) {
                sp[k][0] = i;
                sp[k][1] = j;
                sp[k][2] = matrix[i][j];
                k++;
            }
        }
    }

    cout << "\nCompact Representation (Triplet Format):\n";
    for (int i = 0; i <= nz; i++)
        cout << sp[i][0] << " " << sp[i][1] << " " << sp[i][2] << endl;

    // FAST TRANSPOSE
    int ft[100][3];
    ft[0][0] = sp[0][1];  // rows <-> cols
    ft[0][1] = sp[0][0];
    ft[0][2] = sp[0][2];

    int row_terms[100] = {0};  // count how many terms in each column
    int start_pos[100];        // starting position of each column in result

    // Count number of elements in each column (sp[*][1])
    for (int i = 1; i <= nz; i++) {
        row_terms[ sp[i][1] ]++;
    }

    // Calculate starting positions
    start_pos[0] = 1;
    for (int i = 1; i < cols; i++) {
        start_pos[i] = start_pos[i - 1] + row_terms[i - 1];
    }

    // Place elements in fast transpose matrix
    for (int i = 1; i <= nz; i++) {
        int col = sp[i][1];
        int pos = start_pos[col];

        ft[pos][0] = sp[i][1]; // new row = old col
        ft[pos][1] = sp[i][0]; // new col = old row
        ft[pos][2] = sp[i][2];

        start_pos[col]++; // next insert position
    }

    // Print fast transpose
    cout << "\nFast Transpose (Triplet Format):\n";
    for (int i = 0; i <= nz; i++)
        cout << ft[i][0] << " " << ft[i][1] << " " << ft[i][2] << endl;

    return 0;
}
